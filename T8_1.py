from typing import Callable

def caching_fibonacci() -> Callable[[int], int]:
    """
    Створює кеш для чисел Фібоначчі та повертає функцію для їх обчислення.
    """
    # Словник для зберігання вже обчислених значень (кеш)
    cache: dict[int, int] = {}

    def fibonacci(n: int) -> int:
        """
        Обчислює n-те число Фібоначчі, використовуючи рекурсію та кеш.
        """
        # Базові випадки
        if n <= 0:
            return 0
        if n == 1:
            return 1
        
        # Перевірка, чи є результат у кеші
        if n in cache:
            return cache[n]

        # Рекурсивне обчислення, якщо значення відсутнє в кеші
        # Формула: Fn = Fn-1 + Fn-2
        cache[n] = fibonacci(n - 1) + fibonacci(n - 2)
        
        return cache[n]

    # Повертаємо внутрішню функцію як об'єкт (Замикання)
    return fibonacci

# --- Приклад використання ---
if __name__ == "__main__":
    # Створюємо екземпляр функції з власним кешем
    fib = caching_fibonacci()

    # Перший виклик (обчислення та заповнення кешу)
    print(f"Фібоначчі(10): {fib(10)}")  # Виведе 55
    
    # Другий виклик (значення візьметься вже з кешу)
    print(f"Фібоначчі(15): {fib(15)}")  # Виведе 610
    
    # Виклик дуже великого числа (без кешу це б викликало "зависання")
    print(f"Фібоначчі(50): {fib(50)}")  # Виведе 12586269025
